SHELL:=/bin/bash
CC := gcc
VERILOG := iverilog
VVP := vvp
LIST_INPUT_SIZE := 1024

clean :
	rm -f ans.txt out.txt merger out_no_zeros.txt data.txt ans_no_zeros.txt datagen

merger_1 : MERGER.v AUTO_tb.v BITONIC_NETWORK.v FIFO.v
	iverilog -o merger FIFO.v MERGER.v CONTROL.v BITONIC_NETWORK.v  AUTO_tb.v

datagen :
	gcc -o datagen datagen.c

data_merger_1 : datagen
	./datagen 2 $(LIST_INPUT_SIZE)

compile_merger_1 : FIFO.v MERGER.v CONTROL.v BITONIC_NETWORK.v  AUTO_tb.v
	$(VERILOG) -o merger FIFO.v MERGER.v CONTROL.v BITONIC_NETWORK.v  AUTO_tb.v

sim_merger_1 : compile_merger_1 merger
	$(VVP) merger

filter_output_merger_1 : sim_merger_1 data_merger_1
	sed '/^00000000$$/d' out.txt > out_no_zeros.txt
	sed '/^00000000$$/d' ans.txt > ans_no_zeros.txt

test_merger_1 : data_merger_1 sim_merger_1 filter_output_merger_1 out_no_zeros.txt ans_no_zeros.txt
	if [[ $$(diff -u out_no_zeros.txt ans_no_zeros.txt) ]]; then \
		echo 'ERROR! OUTPUT MISMATCH FOR TEST MERGER_1'1>&2; \
	else \
		echo 'SUCESS! merger_1'1>&2; \
	fi
